\begin{algorithm}[!t]
    \small
    \caption{Batchwise primary node embedding}\label{alg:prim_feat}
    \SetKwFunction{procPrimary}{EmbedPrimary}

    \SetKwProg{myproc}{Procedure}{}{}
    \myproc{\procPrimary{}}{
        \KwIn {
            multimodal graph $G = (\mathcal{V}, \mathcal{E}, \mathcal{A}, \mathcal{R}, \mathcal{X})$,
            mini-batch $\mathcal{B} \subseteq \mathcal{V}$,
            auxiliary node embedding $\mathbf{E} \in \mathbb{R}^{N_{\bar{\mathcal{X}}} \times d }$
            where $N_{\bar{\mathcal{X}}} = |\{v|v \in \mathcal{V}, \mathbf{1}_{\mathcal{X}}(v) = 0\}|$,
            number of convolutional layers $L$
        }
        \KwOut {
            The primary embedding $Z_{\mathcal{B}}$ for nodes in batch $\mathcal{B}$
        }
            $G_{\mathcal{B}}(\mathcal{V}_{\mathcal{B}}, \mathcal{E}_{\mathcal{B}}, \mathcal{A}_{\mathcal{B}}, \mathcal{R}_{\mathcal{B}}, \mathcal{X}_{\mathcal{B}}) \leftarrow \operatorname{HeteroSample}(G, \mathcal{B}, L)$\; \label{alg:pe:sampling}
            \For {$s \in \mathcal{V}_{\mathcal{B}}$} {
                $H_s^{(0)} = \begin{cases}
                    \operatorname{Linear}(\mathbf{x_s}) & \mathbf{1}_{\mathcal{X}}(s) = 1 \\
                    \operatorname{Dropout}(\mathbf{E}_s)& \mathbf{1}_{\mathcal{V}}(s) = 1 \\
                    0_d                                 & \text{otherwise}
                \end{cases}$\; \label{alg:pe:feature_inf}
            }
            \For {$l = 1$ \KwTo $L$} {
                $H^{(l)} = \operatorname{GeLU}(\operatorname{HeteroConv}(G_{\mathcal{B}}, H^{(l-1)}))$\; \label{alg:pe:conv}
            }
            $Z_{\mathcal{B}} = \{H^{(L)}_t | t \in \mathcal{B} \}$\; \label{alg:pe:batch}
        \Return {$Z_{\mathcal{B}}$}
    }
\end{algorithm}
